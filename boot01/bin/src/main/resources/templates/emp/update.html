<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
			xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
			layout:decorate="~{common/layouts/default_layout}"
			layout:fragment="Content">
<head>
<meta charset="UTF-8">
<title>WishğŸ•ğŸ™„</title>

</head>
<body>
	<h3>âœ¨âœ¨ì‚¬ì› ì •ë³´ ìˆ˜ì •âœ¨âœ¨ </h3>
		<!-- ì•¡ì…˜ê³¼ë©”ì†Œë“œí•„ìš”X -->
		<form  name="updateForm" th:object="${empInfo}">
			<div>
				<label>ì‚¬ì›ë²ˆí˜¸</label>
				<input type="number" th:field="*{empid}" readonly>		
			</div>
				<div>
					<label>ì´ë¦„</label>
					<input type="text"  th:field="*{empname}">		
				</div>
				<div>
					<label>ìƒì‚¬ë²ˆí˜¸</label>
					<input type="number" th:field="*{mgr}">		
				</div>
				<div>
					<label>ê¸‰ì—¬</label>
					<input type="number" th:field="*{sal}">		
				</div>
				<div>
					<label>ë¶€ì„œë²ˆí˜¸</label>
					<input type="number" th:field="*{deptid}">		
				</div>
				<div>
					<label>ì…ì‚¬ì¼ì</label>
					<input type="date" th:field="*{hiredate}">		
				</div>
				<div>
					<button type="button" id="updateBtn">ğŸˆì €ì¥ğŸˆ</button>
				</div>
	</form>
	
	<script>
		//$('form[name="updateForm" button]').on('click',updateAjax);
		$('#updateBtn').on('click',updateAjax);
		
		function updateAjax(event){
			//1) ìœ íš¨ì„± ì²´í¬
			if(validationCheck() == false) return;
			//2) ì„œë²„ì— ë³´ë‚¼ ë°ì´í„° ì •ë¦¬
			let dataObj = getEmpObj();
			
			console.log(dataObj);
			//3) Ajax
				//ì œì¼ ì²«ê°’ì€ ê²½ë¡œ! ìƒëŒ€ê²½ë¡œë¡œ ì¼ë‹¨ë„£ì–´ì¤Œ 
				 $.ajax('empUpdate',{
					type : 'post',	// í†µì‹ í•  ë•Œ method : get, post, put, delete
					// => ì•„ë˜ í•œì¤„ : ì»¤ë§¨ë“œê°ì²´, @RequestParam
					//data : dataObj		// ë°ì´íƒ€ëŠ” ê¸°ë³¸ ê°ì²´íƒ€ì…ë§Œ ë°›ëŠ”ë‹¤, ìë™ìœ¼ë¡œ QueryStringë³€í™˜
					
					// => ì•„ë˜ ë‘ì¤„ : @RequestBody
					contentType : 'application/json',
					data : JSON.stringify(dataObj)	//@RequestBodyë¡œ ìš”ì²­ëœê²ƒì´ë¼ jsonìœ¼ë¡œë³´ëƒ„
				})
				.done( result =>{
					console.log(result);
				})
				.fail(err=> console.log(err));
		}
		
		function validationCheck(){
			
			let ename = $('[name="empname"]');
			if(ename.val()==''){
				alert('ì´ë¦„ì€ í•„ìˆ˜ ê°’ì…ë‹ˆë‹¤.');
				ename.focus();
				return false;
			}	
			
			let sal = $('[name="sal"]');
			if(sal.val() < 1000 || sal.val()>99999){
				alert('ê¸‰ì—¬ì˜ ë²”ìœ„ëŠ” 1000~99999ì…ë‹ˆë‹¤');
				sal.focus();
				return false;
			}
			return true;
		}
		
		function getEmpObj(){
			let formAry = $('form[name="updateForm"]').serializeArray();
			// serializeArray => [{ name : 'empid', value : '205'},{ name : 'empname', value : 'ì‚¬ì¿ '}, ... ]
			// í¼ì€ ë°°ì—´í˜•íƒœë¡œ ë„˜ì–´ê°ˆìˆ˜ ì—†ì–´ì„œ ê°ì²´ë¡œ ë§Œë“¤ì–´ì¤˜ì•¼í•¨ 
			// javascriptì—ì„  FormData
			
			let formObj = {};
			$.each(formAry, function(idx, input){
				// input = { name : 'empid', value : '205'} í˜•íƒœë¥¼
				// => { empid : 205 } í˜•íƒœë¡œ ë°”ê¿”ì¤˜ì•¼í•¨
				formObj[input.name] = input.value;
				// formObj['empid'] = '205';
				// formObj.empid == formObj['empid']  
			});
			
			return formObj;
			console.log(formAry);
			//=> { empid : 205 } ë¡œ ë‚˜ì˜´
			
		}
		
		
	</script>
	
</body>
</html>









